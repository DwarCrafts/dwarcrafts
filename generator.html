<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DwarCrafts Order Generator</title>
<style>
  body { font-family:'Segoe UI', sans-serif; background:#fdfaf7; color:#333; margin:0; padding:20px; }
  header { text-align:center; margin-bottom:10px; }
  header img { width:100px; }
  h1 { text-align:center; font-size:32px; color:#5a3921; }
  form { max-width:700px; margin:0 auto; background:white; padding:24px; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.08); }
  label { display:block; margin:12px 0 5px; font-weight:600; }
  input, select, textarea, button { width:100%; padding:10px; margin-bottom:15px; border:1px solid #ccc; border-radius:6px; font-size:15px; }
  button { background:#5a3921; color:white; font-weight:bold; cursor:pointer; }
  button:hover { background:#764e2e; }
  img.preview { display:none; max-width:100%; margin-top:10px; border-radius:10px; border:1px solid #aaa; }
  .success { color:green; font-weight:bold; text-align:center; margin-top:15px; }
</style>
</head>
<body>
<header>
  <img src="Logo.png" alt="DwarCrafts Logo">
</header>
<h1>DwarCrafts Order Form</h1>

<form id="orderForm">
  <label>Name</label>
  <input type="text" id="name" required>

  <label>Phone Number</label>
  <input type="tel" id="phone" required>

  <label>Location</label>
  <input type="text" id="location" required>

  <label>Category</label>
  <select id="category" required></select>

  <label>Space</label>
  <select id="space" required></select>

  <label>Subcategory</label>
  <select id="subcategory" required></select>

  <label>Wood Type</label>
  <input type="text" id="woodType">

  <label>Special Instructions</label>
  <textarea id="instructions" rows="3"></textarea>

  <label>AI Prompt</label>
  <input type="text" id="aiPrompt">
  <button type="button" id="generateAI">ðŸŽ¨ Generate AI Image</button>
  <img id="aiPreview" class="preview">

  <label>Upload Your Image</label>
  <input type="file" id="imageUpload" accept="image/*">
  <img id="imagePreview" class="preview">

  <button type="submit">Submit Order</button>
  <p id="successMsg" class="success"></p>
</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "AIzaSyCvZqDkc9ry9WwkT0rvK30-ZvWv_-7vmig",
  authDomain: "dwarcrafts-firebase.firebaseapp.com",
  projectId: "dwarcrafts-firebase",
  storageBucket: "dwarcrafts-firebase.appspot.com",
  messagingSenderId: "91776713343",
  appId: "1:91776713343:web:63fab986c65c7a7800f54a"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- API & Cloud ---
const hfKey = "191641357456155"; // Your AI key
const cloudName = "dpa1yap5d";
const uploadPreset = "dwarcrafts_uploads";
const whatsappNumber = "254714129889";

// --- DOM Elements ---
const categorySelect = document.getElementById("category");
const spaceSelect = document.getElementById("space");
const subcategorySelect = document.getElementById("subcategory");
const imageInput = document.getElementById("imageUpload");
const imagePreview = document.getElementById("imagePreview");
const aiPreview = document.getElementById("aiPreview");
const generateAIButton = document.getElementById("generateAI");

// --- Categories ---
const categories = {
  "Furniture": { spaces:["Bedroom","Living Room","Dining","Office","Outdoor","Other","Customize"], subs:["Beds","Wardrobes","Dressers","Nightstands","Vanity Tables","Storage Benches","Sofas","Coffee Tables","Side Tables","TV Stands","Recliners","Bookshelves","Dining Tables","Dining Chairs","Buffets","Bar Stools","Cabinets","Wine Racks","Desks","Office Chairs","File Cabinets","Conference Tables","Patio Sets","Benches","Swings","Garden Chairs","Picnic Tables","Other","Customize"] },
  "Decor": { spaces:["Wall Art","Tabletop","Lighting","Other","Customize"], subs:["Paintings","Murals","Wall Hangings","Framed Prints","Sculptural Art","Vases","Bowls","Trays","Candlesticks","Mini Sculptures","Lamps","Lanterns","Wall Lights","Ceiling Pendants","Candle Holders","Other","Customize"] },
  "Resin & Epoxy Art": { spaces:["Tables","Wall Art","Decor","Other","Customize"], subs:["River Tables","Epoxy Dining Tables","Epoxy Coffee Tables","Epoxy Paintings","Abstract Panels","3D Resin Waves","Epoxy Coasters","Keychains","Epoxy Jewelry","Other","Customize"] },
  "Calligraphy": { spaces:["Styles","Products","Other","Customize"], subs:["Arabic Calligraphy","Modern Script","Gothic","Italic","Brush Lettering","Cards","Quotes","Wall Frames","Scrolls","Digital Calligraphy","Other","Customize"] },
  "Crochet": { spaces:["Wearables","Home","Accessories","Other","Customize"], subs:["Sweaters","Scarves","Hats","Gloves","Socks","Blankets","Cushion Covers","Table Runners","Curtains","Wall Hangings","Bags","Keychains","Headbands","Bracelets","Toys","Other","Customize"] },
  "Sand Art": { spaces:["Bottled Art","Canvas","Decor","Other","Customize"], subs:["Layered Bottles","Themed Sand Bottles","Sand Paintings","Abstract Sand Textures","Sand Vases","Sculptural Sand Frames","Other","Customize"] },
  "Aari Work & Embroidery": { spaces:["Fashion","Home Decor","Accessories","Other","Customize"], subs:["Sarees","Blouses","Dresses","Dupattas","Lehengas","Cushions","Curtains","Bed Covers","Bags","Clutches","Wall Frames","Other","Customize"] },
  "Drawing & Pencil Art": { spaces:["Portraits","Scenery","Illustrations","Other","Customize"], subs:["Realistic Portraits","Sketches","Charcoal Portraits","Nature","Urban Landscapes","Abstract","Cartoon","Comics","Concept Art","Other","Customize"] },
  "Other": { spaces:["Other"], subs:["Other"] },
  "Customization": { spaces:["Customize"], subs:["Customize"] }
};

// Populate categories
for(const cat in categories) categorySelect.innerHTML += `<option value="${cat}">${cat}</option>`;
categorySelect.addEventListener("change", ()=>{
  const selected = categorySelect.value;
  spaceSelect.innerHTML=""; subcategorySelect.innerHTML="";
  categories[selected].spaces.forEach(s=>spaceSelect.innerHTML+=`<option>${s}</option>`);
  categories[selected].subs.forEach(s=>subcategorySelect.innerHTML+=`<option>${s}</option>`);
});
categorySelect.dispatchEvent(new Event("change"));

// Image preview
imageInput.addEventListener("change", ()=>{
  const file = imageInput.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{ imagePreview.src=reader.result; imagePreview.style.display="block"; };
  reader.readAsDataURL(file);
});

// --- AI Generation ---
generateAIButton.addEventListener("click", async ()=>{
  const prompt = document.getElementById("aiPrompt").value.trim();
  if(!prompt) return alert("Enter AI prompt");
  generateAIButton.textContent="Generating..."; generateAIButton.disabled=true;
  try{
    const response = await fetch("https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-2", {
      method:"POST",
      headers:{Authorization:`Bearer ${hfKey}`, "Content-Type":"application/json"},
      body: JSON.stringify({inputs:prompt})
    });
    const blob = await response.blob();
    const url = URL.createObjectURL(blob);
    aiPreview.src = url;
    aiPreview.style.display="block";
  }catch(e){ alert("AI generation failed"); console.error(e);}
  generateAIButton.textContent="ðŸŽ¨ Generate AI Image"; generateAIButton.disabled=false;
});

// --- Form Submission ---
document.getElementById("orderForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const data = {
    name: document.getElementById("name").value,
    phone: document.getElementById("phone").value,
    location: document.getElementById("location").value,
    category: categorySelect.value,
    space: spaceSelect.value,
    subcategory: subcategorySelect.value,
    woodType: document.getElementById("woodType").value,
    instructions: document.getElementById("instructions").value,
    timestamp: serverTimestamp()
  };
  try{
    await addDoc(collection(db,"orders"),data);
    document.getElementById("successMsg").textContent="Order submitted successfully!";
    // WhatsApp link
    const msg = encodeURIComponent(`Hello, I want to place an order:\nName: ${data.name}\nPhone: ${data.phone}\nLocation: ${data.location}\nCategory: ${data.category}\nSpace: ${data.space}\nSubcategory: ${data.subcategory}\nNotes: ${data.instructions}`);
    window.open(`https://wa.me/${whatsappNumber}?text=${msg}`, "_blank");
    document.getElementById("orderForm").reset();
    imagePreview.style.display="none"; aiPreview.style.display="none";
  }catch(err){ console.error(err); alert("Error submitting order."); }
});
</script>
</body>
</html>
